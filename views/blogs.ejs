<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    <%= title %>
  </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="icon" type="image/png" href="/images/Site-icon.png" />
  <link rel="stylesheet" href="/css/style.css">

  <style>
    .blogs-page .row {
      display: flex;
      flex-wrap: wrap;
      margin-right: -0.75rem;
      margin-left: -0.75rem;
      gap: 1.5rem;
      /* Gutter spacing */
    }

    .blogs-page {
      zoom: 0.9;
    }

    /* Force 3 columns on md+ with gap */
    .blogs-page .col-md-4 {
      flex: 0 0 calc(33.333% - 1rem);
      max-width: calc(33.333% - 1rem);
      padding: 0 0.75rem;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }

    /* Blog card fills column height */
    .blogs-page .blog-card {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: box-shadow 0.3s ease;
    }

    .blogs-page .blog-card:hover {
      box-shadow: var(--shadow-hover);
    }

    /* Card image fixed size and object-fit */
    .blogs-page .blog-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
      flex-shrink: 0;
    }

    /* Card content grows */
    .blogs-page .blog-card .card-body {
      flex-grow: 1;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }
  </style>
</head>

<body>

  <%- include('partials/nav') %>

    <div class="container my-5 blogs-page">

      <!-- ===== Latest Posts Section ===== -->
      <section class="blogs-section">
        <h1 class="section-title">ðŸ“… Latest Posts</h1>
        <div class="row">
          <% if (latestBlogs && latestBlogs.length> 0) { %>
            <% latestBlogs.forEach(blog=> { %>
              <div class="col-md-4 mb-4">
                <div class="blog-card" data-url="/blog/<%= blog._id %>">
                  <%- include('partials/blogCard', { blog, user }) %>
                </div>
              </div>
              <% }) %>
                <% } else { %>
                  <p class="text-muted">No latest blogs found.</p>
                  <% } %>
        </div>
      </section>

      <!-- ===== Most Popular This Year Section ===== -->
      <section class="blogs-section mt-5">
        <h1 class="section-title">ðŸ”¥ Most Popular This Year</h1>
        <div class="row">
          <% if (popularBlogs && popularBlogs.length> 0) { %>
            <% popularBlogs.forEach(blog=> { %>
              <div class="col-md-4 mb-4">
                <div class="blog-card" data-url="/blog/<%= blog._id %>">
                  <%- include('partials/blogCard', { blog, user }) %>
                </div>
              </div>
              <% }) %>
                <% } else { %>
                  <p class="text-muted">No popular blogs for this year yet.</p>
                  <% } %>
        </div>
      </section>

      <!-- ===== Random Picks Section ===== -->
      <section class="blogs-section mt-5">
        <h1 class="section-title">ðŸŽ¯ Random Picks</h1>
        <div class="row">
          <% if (randomBlogs && randomBlogs.length> 0) { %>
            <% randomBlogs.forEach(blog=> { %>
              <div class="col-md-4 mb-4">
                <div class="blog-card" data-url="/blog/<%= blog._id %>">
                  <%- include('partials/blogCard', { blog, user }) %>
                </div>
              </div>
              <% }) %>
                <% } else { %>
                  <p class="text-muted">No random blogs available at the moment.</p>
                  <% } %>
        </div>
      </section>

    </div>

    <%- include('partials/footer') %>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

      <script>
        // Make the whole blog card clickable except buttons, links, forms
        document.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('.blog-card').forEach(card => {
            card.addEventListener('click', function (e) {
              if (!e.target.closest('a') && !e.target.closest('button') && !e.target.closest('form')) {
                window.location.href = this.dataset.url;
              }
            });
          });
        });
      </script>

</body>

</html>